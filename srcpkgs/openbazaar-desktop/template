# Template file for 'openbazaar-desktop'
pkgname=openbazaar-desktop
version=2.4.4
revision=1
archs="x86_64 i686 aarch64 armv7l"
hostmakedepends="nodejs unzip"
short_desc="OpenBazaar 2.0 Desktop Client"
maintainer="Cameron Nemo <cnemo@tutanota.com>"
license="MIT"
homepage="https://openbazaar.org/"
distfiles="https://github.com/OpenBazaar/openbazaar-desktop/archive/v${version}.tar.gz"
checksum=c2299a17506623fc7e7649cdf741b0d9371e1067e5720f52be4c05f94ac78124
nostrip=yes

case "$XBPS_TARGET_MACHINE" in
	x86_64*) _arch=x64 ;;
	i686*) _arch=ia32 ;;
	aarch64*) _arch=arm64 ;;
	armv7l*) _arch=armv7l ;;
esac

do_build() {
	npm install electron-packager -g --silent
	npm install npm-run-all -g --silent
	npm install grunt-cli -g --silent
	npm install grunt --save-dev --silent
	npm install grunt-electron-installer --save-dev --silent
	npm install --silent
	npm run build
	cp -rf prod/* js/
	electron-packager . "${pkgname}" --platform=linux --arch="${_arch}"
}

do_install() {
	vmkdir "usr/lib/${pkgname}"
	vcopy "${pkgname}-linux-${_arch}"/* "usr/lib/${pkgname}"

	vmkdir usr/bin
	ln -s "../lib/${pkgname}/${pkgname}" "${DESTDIR}/usr/bin/"

	vmkdir usr/share/applications
	vinstall "${FILESDIR}/${pkgname}.desktop" 644 usr/share/applications

	vmkdir usr/share/pixmaps
	vinstall imgs/icon.png 644 usr/share/pixmaps "${pkgname}.png"

	vlicense LICENSE
}
