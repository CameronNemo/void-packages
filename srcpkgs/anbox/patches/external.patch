--- CMakeLists.txt.orig	2020-11-07 20:47:25.702416886 +0000
+++ CMakeLists.txt	2020-11-07 20:58:16.665674636 +0000
@@ -62,6 +62,7 @@
 find_package(EGL REQUIRED)
 find_package(GLESv2 REQUIRED)
 find_package(Protobuf REQUIRED)
+find_package(CpuFeatures REQUIRED)
 
 pkg_check_modules(SDL2 sdl2 REQUIRED)
 pkg_check_modules(SDL2_IMAGE SDL2_image REQUIRED)
@@ -70,6 +71,7 @@
 pkg_check_modules(PROPERTIES_CPP properties-cpp REQUIRED)
 pkg_check_modules(LIBSYSTEMD libsystemd REQUIRED)
 pkg_check_modules(LIBCAP libcap REQUIRED)
+pkg_check_modules(SDBUS_CPP sdbus-c++ REQUIRED)
 
 message(STATUS "LXC version: ${LXC_VERSION}")
 if (${LXC_VERSION} VERSION_LESS 3.0)
--- external/CMakeLists.txt.orig	2020-11-07 16:40:48.438101045 +0000
+++ external/CMakeLists.txt	2020-11-07 16:41:16.257390964 +0000
@@ -2,16 +2,3 @@
 add_subdirectory(android-emugl)
 add_subdirectory(xdg)
 add_subdirectory(backward-cpp)
-
-set(BUILD_TESTING OFF)
-set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -Wno-error")
-add_subdirectory(cpu_features)
-include(ExternalProject)
-ExternalProject_Add(sdbus-cpp
-  PREFIX sdbus-cpp
-  SOURCE_DIR "${CMAKE_CURRENT_SOURCE_DIR}/sdbus-cpp"
-  INSTALL_COMMAND ""
-  CMAKE_CACHE_ARGS
-        -DBUILD_CODE_GEN:BOOL=ON
-        -DBUILD_SHARED_LIBS:BOOL=OFF
-)
---- src/anbox/cmds/system_info.cpp.orig	2020-11-07 21:33:35.511179638 +0000
+++ src/anbox/cmds/system_info.cpp	2020-11-07 21:37:58.404418235 +0000
@@ -30,7 +30,7 @@
 
 #include "OpenGLESDispatch/EGLDispatch.h"
 
-#include "cpu_features_macros.h"
+#include <cpu_features/cpu_features_macros.h>
 #if defined(CPU_FEATURES_ARCH_X86)
 #include "cpuinfo_x86.h"
 #endif
--- src/anbox/cmds/check_features.cpp.orig	2020-11-07 21:33:35.521179380 +0000
+++ src/anbox/cmds/check_features.cpp	2020-11-07 21:37:48.454674135 +0000
@@ -18,7 +18,7 @@
 #include "anbox/cmds/check_features.h"
 #include "anbox/utils.h"
 
-#include "cpu_features_macros.h"
+#include <cpu_features/cpu_features_macros.h>
 #if defined(CPU_FEATURES_ARCH_X86)
 #include "cpuinfo_x86.h"
 #endif
-- src/CMakeLists.txt.orig	2020-11-07 21:10:22.856997581 +0000
+++ src/CMakeLists.txt	2020-11-07 20:59:40.493518651 +0000
@@ -8,6 +8,8 @@
   ${LXC_INCLUDE_DIRS}
   ${MIRCLIENT_INCLUDE_DIRS}
   ${LIBSYSTEMD_INCLUDE_DIRS}
+  ${SDBUS_CPP_INCLUDE_DIRS}
+  ${CpuFeatures_INCLUDE_DIRS}
   ${CMAKE_CURRENT_BINARY_DIR}
   ${CMAKE_SOURCE_DIR}
   ${CMAKE_SOURCE_DIR}/src
@@ -25,8 +27,6 @@
   ${CMAKE_BINARY_DIR}/external/android-emugl/host/libs/GLESv2_dec
   ${CMAKE_SOURCE_DIR}/external/android-emugl/host/libs/renderControl_dec
   ${CMAKE_BINARY_DIR}/external/android-emugl/host/libs/renderControl_dec
-  ${CMAKE_SOURCE_DIR}/external/cpu_features/include
-  ${CMAKE_SOURCE_DIR}/external/sdbus-cpp/include
 )
 
 set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -DBINDERFS_PATH=\"\\\"${BINDERFS_PATH}\\\"\"")
@@ -59,7 +59,7 @@
 target_link_libraries(anbox-protobuf
     ${PROTOBUF_LITE_LIBRARIES})
 
-set(XML2CPP ${CMAKE_BINARY_DIR}/external/sdbus-cpp/src/sdbus-cpp-build/tools/sdbus-c++-xml2cpp)
+set(XML2CPP /usr/bin/sdbus-c++-xml2cpp)
 
 macro(DBusServer BaseName)
     add_custom_command(
@@ -398,7 +398,10 @@
   ${MIRCLIENT_LIBRARIES}
   ${LIBSYSTEMD_LDFLAGS}
   ${LIBSYSTEMD_LIBRARIES}
-  cpu_features
+  ${SDBUS_CPP_LDFLAGS}
+  ${SDBUS_CPP_LIBRARIES}
+  ${CpuFeatures_LDFLAGS}
+  ${CpuFeatures_LIBRARIES}
   pthread
   process-cpp
   emugl_common
@@ -408,11 +411,8 @@
   OpenGLESDispatch
   OpenglCodecCommon
   anbox-protobuf
-  sdbus-c++
   xdg)
 
-link_directories(${CMAKE_CURRENT_BINARY_DIR}/../external/sdbus-cpp/src/sdbus-cpp-build/)
-
 add_executable(anbox main.cpp ${BACKWARD_ENABLE})
 target_link_libraries(anbox
     anbox-core)
